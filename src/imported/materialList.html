<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="style.css" rel="stylesheet" type="text/css" />

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <title>Material Ui</title>
</head>

<body>
    <div class="material_list" id="mat_list">
        <div class="material active">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color gradient"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color gradient"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <div class="material ">
            <div class="material_wrap">
                <div class="material_preview ">
                    <div class="background_preview-color textured"></div>
                </div>
                <p class="material_name">Material 01</p>
            </div>
            <div class="icon_wrap">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line class="minus_icon" x1="4.5" y1="8.5" x2="12.5" y2="8.5" stroke="#4D4D4D"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>
    </div>


    <input type="text" value="new">

    <script>
        async function run() {
            //for switching between fade-states later. When we are on the top of the screen we have fade on the bottom, in the middle both ways, and on bottom only top.
            //see fade-both, fade-down, fade-up classes
            let scrollPos = 0

            //matList is the main list for all the materials to exist in
            const matList = document.getElementById("mat_list")

            const previewIcons = document.querySelectorAll(".material_preview")

            //adds fade and invisible icon to inactive mayerials
            function SetIconsForInactiveElements() {
                Array.from(document.querySelectorAll(".material")).map(views => {
                    let nonVisibleIcons = document.createElement("div")
                    nonVisibleIcons.classList.add("not_visible-icon")
                    let appliedNonVisibleIcon = views.querySelector(".material_wrap .material_preview .not_visible-icon")
                    let matPreviewCircle = views.querySelector(".material_wrap .material_preview .background_preview-color")

                    if (!views.classList.contains("active") && appliedNonVisibleIcon === null) {

                        //Add your own icons or fetch here <-------------------------------------
                        fetch("./sprites/Action_Hidden_1.svg")
                            .then(res => res.text())
                            .then(data => nonVisibleIcons.innerHTML = data)


                        views.querySelectorAll(".material_wrap .material_preview")[0].prepend(nonVisibleIcons)
                        views.querySelectorAll(".material_wrap .material_preview .background_preview-color")[0].classList.add("inactive")
                    }
                    if (views.classList.contains("active")) {

                        //If the material becomes active again removes all the fades and icons
                        if (appliedNonVisibleIcon != null) {
                            views.querySelector(".material_wrap .material_preview").removeChild(appliedNonVisibleIcon)
                            matPreviewCircle.classList.remove("inactive")
                        }
                    }
                });
            }

            SetIconsForInactiveElements();

            function SwitchFadeStates() {
                let listBox = document.querySelector("#mat_list").getBoundingClientRect();
                let active = document.querySelector(".active");
                let activeElem = active.getBoundingClientRect();

                if (activeElem.y === listBox.y) {
                    if (matList.classList.contains("fade-both") || matList.classList.contains("fade-down")) {
                        matList.classList.remove("fade-down");
                        matList.classList.remove("fade-both");
                    }
                    console.log("up");
                    matList.classList.add("fade-up");
                }
                else if (activeElem.y === listBox.height) {
                    if (matList.classList.contains("fade-both") || matList.classList.contains("fade-up")) {
                        matList.classList.remove("fade-up");
                        matList.classList.remove("fade-both");
                    }
                    console.log("down");
                    matList.classList.add("fade-down");
                }
                else {
                    console.log("both");
                    matList.classList.remove("fade-up");
                    matList.classList.remove("fade-down");
                    matList.classList.add("fade-both");
                }
            }

            //scroll lisnener for switching fade states
            matList.addEventListener("scroll", () => {
                SwitchFadeStates();
            });

            //Activate material on which we have clicked - !! THE FIRST MATERIAL IS SET AMNUALLY BY GIVING IT AN ACTIVE CLASS !!!
            Array.from(matList.children).map((selectMat) => {
                selectMat.addEventListener("click", () => {
                    let currentSelection = Array.from(document.querySelectorAll(".material")).filter(x => x.classList.contains("active"))[0];
                    Array.from(document.querySelectorAll(".material")).map(resetItem => {
                        resetItem.classList.remove("active")
                    });
                    let selected = selectMat;

                    selected.classList.add("active");
                    SwitchFadeStates();
                    SetIconsForInactiveElements();
                });
            });

            //Swaps the text field with an input field
            function setInputSwapLogic() {
                const matNames = document.querySelectorAll(".material_name")

                Array.from(matNames).map(matName => {
                    matName.addEventListener("dblclick", () => {
                        const materialRow = matName.parentNode.parentNode;
                        const materialWrap = matName.parentNode.parentNode;
                        const inputField = document.createElement("input");
                        inputField.type = "text";
                        inputField.name = matName.textContent;
                        inputField.textContent = matName.textContent;
                        inputField.value = matName.textContent;
                        inputField.classList.add("Mat_input");

                        matName.parentNode.insertBefore(inputField, matName);
                        matName.parentNode.removeChild(matName);
                        console.log(inputField);
                        inputField.select();
                        inputField.focus();

                        inputField.addEventListener("keydown", e => {
                            if (e.keyCode == 13) {
                                SwapInputBackToText(inputField);
                            }
                        });

                        inputField.addEventListener("dblclick", () => {
                            inputField.select();
                        });

                        document.addEventListener("click", e => {
                            if (!inputField.contains(e.target)) {
                                SwapInputBackToText(inputField);
                            }
                        });
                    });
                })
            }

            //Swaps the input field back to paragraph
            function SwapInputBackToText(inputField) {
                const newText = document.createElement("p");
                newText.classList.add("material_name");
                newText.textContent = inputField.value;
                inputField.parentNode.insertBefore(newText, inputField);
                inputField.parentNode.removeChild(inputField);
                setInputSwapLogic();
            }

            setInputSwapLogic();

            //external library for sorting - works better than mine
            new Sortable(matList, {
                handle: ".material",
                animation: 200,
                easing: "cubic-bezier(1, 0, 0, 1)",
                onMove: evt => evt.dragged.classList.add("Mat_OnDrag"),
                onEnd: evt => evt.item.classList.remove("Mat_OnDrag"),
            });
        }
        run();
    </script>
</body>

</html>
